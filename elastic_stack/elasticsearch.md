# Elasticsearch 란?
 - Apache Lucene 기반으로 개발한 실시간 분산 검색 엔진(서버).
 - JSON 기반의 비정형 데이터 분산 검색과 분석을 지원.
 - 서버 확장 편리, 실시간 검색 서비스 지원, 분산 및 병렬처리, 멀티테넌시 기능 제공.
 - 다양한 가능을 plugin 으로 제공.
 - 분산 시스템이기 때문에 검색 대상의 용량이 증가하였을 경우 대응하기 수월.
 - 웹 문서 검색, 소셜 데이터 검색, 쇼핑몰 검색, 빅데이터 검색 과 분석 서비스 등에 활용 가능.

 >> 비정형 데이터 란?

    데이터 형태에 따라 정형, 반정형, 비정형 데이터가 있다. 이 떄 구분하는 기준은 스키마 형태의 유무, 연산 가능 및 불가능으로 구별한다. 

    1. 정형 데이터 : 형태 O, 연산O, RDBMS 로 저장 
    2. 반정형 데이터 : 형태 O, 연산X, 파일로 저장 (ex. 로그)
    3. 비정형 데이터 : 형태 X, 연산X, NoSQL 저장구조  (ex. 소셜 데이터, 텍스트 영상, 음성)


## Elastic Stack
Elasticsearch, Kibana, Logstash, Beats 등을 활용한 것. (예전에는 Elasticsearch + Kibana + Logstash 를 묶어 ELK stack 이라고 불렀다.)


## X-pack
Elastic Stack 에서 제공되지 않는 여러가지 기능들을 묶어 elastic 사에서 확장팩으로 제시하는 것.

보안, 알림, 모니터링, 그래프 분석, 보고서를 만들 수 있는 기능, 머신러닝 기등들이 들어있다.

## Elasticsearh clustering
 - 대용량 검색을 위해서는 클러스터링이 필요.
 - Elasticsearch 는 데이터를 Shard(샤드) 단위로 분리해서 저장.
 - 노드를 여러개 실행시키면 같은 클러스터로 묶인다.
 - 노드가 여러개 생성이 되면은 샤드들은 각각의 노드들에 분배되어 저장.
 - 무결성과 가용성을 위해 Replica(같은 내용의 복제본) 과 샤드는 서로 다른 노드에 저장. 이떄 replica 갯수는 유동적으로 조절 가능.
 - 항상 primary shard 와 replica 는 같은 내용의 document 들을 저장하고 있다.
 - 만약에 시스템 다운이나 네트워크 단절 등으로 유실된 노드가 발생 -> replica 가 없는 샤드들은 다른 살아있는 노드로 복제된다. 노드의 수가 줄어들어도 샤드의 수는 변함없으므로 무결셩을 유지할 수 있다.

### 검색 과정 - Query Parse
처음 쿼리 수행명령을 받은 노드는 모든 샤드에게 쿼리를 전달. 1차적으로 모든 샤드(or replica) 검색을 실행. 각 샤드들은 요청된 크기만큼의 검색 결과 큐를 노드로 리턴. 리턴된 결과는 루씬 doc id 와 랭킹 점수만 가지고 있다. 

### 검색 과정2 - Fetch Phase
노드는 리턴된 결과들의 랭킹 점수를 기반으로 정렬한 뒤 유효한 샤드들에게 최종 결과들을 다시 요청한다. 그 샤드들은 전체문서 내용(_source) 등의 정보가 리턴되어 클라이언트로 전달된다.
